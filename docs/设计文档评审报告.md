# 语音转写小程序设计文档评审报告（MVP）

评审日期：2026-02-21  
评审范围：
- /Users/zzw/Documents/语音识别/技术路线.md
- /Users/zzw/Documents/语音识别/功能详细设计.md
- /Users/zzw/Documents/语音识别/测试方案.md

评审目标：可落地性风险优先，输出可执行整改结论。

---

## 一、评审结论

1. 原设计可表达核心业务目标，但存在 3 个 P0 阻塞风险，会直接影响 MVP 稳定落地。
2. 本轮整改已完成架构统一、接口契约收敛、测试分层和边界澄清。
3. 当前文档版本满足“个人自用 MVP”实施条件。

---

## 二、问题分级与整改状态

| 编号 | 级别 | 问题 | 影响 | 整改方案 | 状态 |
|---|---|---|---|---|---|
| R-01 | P0 | `rumps + PySide6` 双事件循环并存风险 | UI 卡死、线程协作复杂、退出不稳定 | 统一为 `PySide6 QApplication + QSystemTrayIcon` 单循环 | 已关闭 |
| R-02 | P0 | ASR 流式契约不清，业务直接依赖 SDK 结构 | 实现易偏差，异常难处理 | 引入 `RecognizerAdapter` + `RecognitionEvent` 标准事件 | 已关闭 |
| R-03 | P0 | 要求恢复图片/富文本剪贴板，但实现路径仅 `pyperclip` 文本能力 | 验收无法达成 | 降级为“文本剪贴板恢复”为 MVP 必做，富媒体移出范围 | 已关闭 |
| R-04 | P1 | 热键防抖、重复触发、取消路径未形成显式状态机 | 重入、粘连状态 | 定义 `IDLE->RECORDING->FINALIZING->PASTING->IDLE/ERROR` | 已关闭 |
| R-05 | P1 | 错误码与提示不统一 | 排障困难，测试无法标准化 | 建立统一错误码字典和重试语义 | 已关闭 |
| R-06 | P1 | 测试方案混合系统依赖，CI 不稳定 | 回归误报/漏报 | 拆分 unit/integration/e2e/manual 四层 | 已关闭 |
| R-07 | P2 | 参数口径不一致（100/200ms、失败兜底等） | 文档与实现偏移 | 统一参数表并固化默认值 | 已关闭 |

---

## 三、整改后关键变化

1. 公共接口新增：`SessionController`、`AudioFrame`、`RecognitionEvent`、`PasteService`、`ConfigStore`。
2. 错误治理新增：`PERMISSION_DENIED`、`NETWORK_ERROR`、`AUTH_FAILED`、`NO_ACTIVE_TARGET`、`ASR_PROTOCOL_ERROR`。
3. 并发治理新增：有界队列、Sentinel 停止、幂等 stop、超时收尾。
4. 测试策略新增：CI 快速集合与每日 E2E 集合分离，发布前人工清单独立维护。

---

## 四、残余风险

1. 系统权限与焦点行为仍受 macOS 版本差异影响，需要发布前实机回归。
2. 云端 ASR 供应商接口若变动，需在 `RecognizerAdapter` 内快速适配。
3. 输入法与第三方应用兼容性需通过人工清单持续验证。

---

## 五、完成定义核对

| 完成条件 | 结果 |
|---|---|
| P0 问题全部关闭 | 通过 |
| P1 问题有明确方案并入文档 | 通过 |
| 三份文档术语、参数、边界一致 | 通过 |
| 测试和验收可执行 | 通过 |

总体结论：文档整改已达到 MVP 实施标准，可进入开发执行阶段。
